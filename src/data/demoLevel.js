import { TILE } from '../core/constants.js';

const baseSwitches = [
  {
    id: 'entry-switch',
    name: 'Vstupn√≠ vyp√≠naƒç',
    tx: 5,
    ty: 2,
    lights: [
      {
        x: 1,
        y: 1,
        w: 10,
        h: 7,
      },
    ],
  },
  {
    id: 'storage-switch',
    name: 'Skladov√Ω vyp√≠naƒç',
    tx: 13,
    ty: 5,
    lights: [
      {
        x: 9,
        y: 4,
        w: 7,
        h: 7,
      },
    ],
  },
  {
    id: 'lab-switch',
    name: 'Laboratorn√≠ vyp√≠naƒç',
    tx: 17,
    ty: 9,
    lights: [
      {
        x: 13,
        y: 7,
        w: 6,
        h: 6,
      },
    ],
  },
];

/** @type {import('./types.js').LevelConfig} */
export const demoLevel = {
  meta: {
    id: 'demo-facility',
    name: 'Demo Facility',
    title: 'Demo Facility',
    subtitle: 'WASD/≈°ipky = pohyb ¬∑ E = interakce ¬∑ Mezern√≠k = st≈ôelba',
    levelNumber: 0,
  },
  // Locked layout (what the player sees on load).
  map: [
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,
    1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1,
    1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1,
    1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1,
    1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1,
    1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1,
    1, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1,
    1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1,
    1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 0, 1,
    1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 2, 1, 1, 1, 0, 1,
    1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 1,
    1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1,
    1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
  ],
  // Layout after unlocking the gate. Used to restore the intended shape once the
  // player receives the key.
  unlockedMap: [
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,
    1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1,
    1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1,
    1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1,
    1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1,
    1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1,
    1, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1,
    1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1,
    1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
  ],
  lighting: {
    litZones: [
      {
        x: 1,
        y: 1,
        w: 5,
        h: 4,
      },
    ],
    switches: baseSwitches,
  },
  interactables: {
    switches: baseSwitches,
    gate: {
      id: 'main-gate',
      tx: 14,
      ty: 10,
      locked: true,
      openTile: 0,
      sealedTiles: [
        [14, 9],
        [15, 9],
        [16, 9],
        [15, 10],
        [16, 10],
        [17, 10],
        [15, 11],
        [16, 11],
        [17, 11],
        [15, 12],
        [16, 12],
        [17, 12],
      ],
      promptLocked: 'Dve≈ôe jsou zamƒçen√©. Technik J√°ra m√° kl√≠ƒç.',
      promptUnlocked: 'Dve≈ôe jsou otev≈ôen√©, stiskni E pro vstup do nov√© mapy.',
      speaker: 'Syst√©m Dve≈ô√≠',
      unlockLine: 'Vstup potvrzen. P≈ôech√°z√≠≈° do nov√©ho mapov√©ho k≈ô√≠dla.',
      consumeNote: 'Kl√≠ƒç se zasunul do z√°mku a zmizel z invent√°≈ôe.',
    },
  },
  actors: {
    playerStart: { x: TILE * 2.5, y: TILE * 2.5 },
    monsters: [],
    props: [],
    npcs: [
      {
        id: 'caretaker',
        name: 'Spr√°vce Laborato≈ôe',
        tx: 10,
        ty: 4,
        dialogue: 'Pot≈ôebuji n√°hradn√≠ ƒçl√°nky a n√°≈ôad√≠. Najde≈° je ve skladi≈°ti.',
      },
      {
        id: 'technician',
        name: 'Technik J√°ra',
        tx: 6,
        ty: 9,
        dialogue: 'Hej, sly≈°el jsem ≈°umƒõn√≠ u zadn√≠ho skladu. Mo≈æn√° tam nƒõco bl√Ωsk√°.',
        info: 'Technik J√°ra ti po≈°eptal: "V rohu skladi≈°tƒõ u zdi z≈Østal energoblok, zkus ho vz√≠t."',
      },
      {
        id: 'key-guard',
        name: 'Hl√≠daƒç Kl√≠ƒçe',
        tx: 18,
        ty: 11,
        sprite: 'monster',
        dialogue: 'St≈Øj! Kl√≠ƒç tady nikdo neukradne.',
        patrol: [
          { tx: 18, ty: 1 },
          { tx: 18, ty: 12 },
        ],
        speed: 50,
        lethal: true,
        health: 3,
      },
    ],
  },
  pickups: [
    {
      id: 'battery-cell',
      name: 'Battery Cell',
      icon: '‚ö°',
      x: TILE * 9 + TILE / 2,
      y: TILE * 6 + TILE / 2,
      tint: '#f2d45c',
      description: 'A humming power source for the lab lights.',
      objective: true,
    },
    {
      id: 'wrench',
      name: 'Service Wrench',
      icon: 'üîß',
      x: TILE * 12 + TILE / 2,
      y: TILE * 9 + TILE / 2,
      tint: '#8ce0ff',
      description: 'Useful for tightening mech armor plating.',
      objective: true,
    },
    {
      id: 'keycard',
      name: 'Keycard Fragment',
      icon: 'üóùÔ∏è',
      x: TILE * 18 + TILE / 2,
      y: TILE * 12 + TILE / 2,
      tint: '#c66bff',
      description: 'One part of an access card. Collect the rest later.',
      objective: true,
    },
    {
      id: 'ammo',
      name: 'N√°boje',
      icon: '‚Ä¢',
      x: TILE * 4 + TILE / 2,
      y: TILE * 4 + TILE / 2,
      tint: '#f28f5c',
      description: 'Munice pro tvoji pistoli.',
      objective: false,
      stackable: true,
      quantity: 6,
    },
    {
      id: 'ammo',
      name: 'N√°boje',
      icon: '‚Ä¢',
      x: TILE * 16 + TILE / 2,
      y: TILE * 8 + TILE / 2,
      tint: '#f28f5c',
      description: 'Munice pro tvoji pistoli.',
      objective: false,
      stackable: true,
      quantity: 6,
    },
  ],
  quests: [
    {
      id: 'collect-components',
      name: 'Zajisti komponenty',
      description: 'Sesb√≠rej energoblok, kl√≠ƒçov√Ω fragment a servisn√≠ n√°≈ôad√≠.',
      objectiveCount: 3,
      completionNote: 'Mise splnƒõna: v≈°echny komponenty jsou p≈ôipraven√©. Vra≈• se za Technikem J√°rou.',
    },
  ],
  npcScripts: {
    caretaker: {
      defaultDialogue: 'Pot≈ôebuji n√°hradn√≠ ƒçl√°nky a n√°≈ôad√≠. Najde≈° je ve skladi≈°ti.',
      lines: [
        {
          id: 'give-apple',
          when: [{ flag: 'caretakerGaveApple', equals: false }],
          dialogue: 'Tady m√°≈° jablko, dopln√≠ ti s√≠ly. Stiskni ƒç√≠slo slotu nebo na nƒõj klikni v invent√°≈ôi.',
          note: 'Spr√°vce ti p≈ôedal jablko. Pou≈æij ƒç√≠slo slotu (1-6) nebo klikni na slot pro doplnƒõn√≠ jednoho ≈æivota.',
          rewardId: 'caretaker-apple',
          setState: { caretakerGaveApple: true },
        },
        {
          id: 'apple-reminder',
          when: [
            { flag: 'caretakerGaveApple', equals: true },
            { hasItem: 'apple' },
          ],
          dialogue: 'Jablko m√°≈° v invent√°≈ôi. Klikni na slot nebo stiskni jeho ƒç√≠slo, a≈æ bude≈° pot≈ôebovat ≈æivot.',
        },
        {
          id: 'caretaker-default',
          dialogue: 'Pot≈ôebuji n√°hradn√≠ ƒçl√°nky a n√°≈ôad√≠. Najde≈° je ve skladi≈°ti.',
        },
      ],
    },
    technician: {
      defaultDialogue: 'Hej, sly≈°el jsem ≈°umƒõn√≠ u zadn√≠ho skladu. Mo≈æn√° tam nƒõco bl√Ωsk√°.',
      infoNote: 'Technik J√°ra ti po≈°eptal: "V rohu skladi≈°tƒõ u zdi z≈Østal energoblok, zkus ho vz√≠t."',
      lines: [
        {
          id: 'collect-first',
          when: [{ questIncomplete: 'collect-components' }],
          dialogue: 'Mus√≠≈° don√©st v≈°echny d√≠ly. Jakmile je m√°≈°, vr√°t√≠≈° se pro kl√≠ƒç a j√° ti otev≈ôu dve≈ôe.',
        },
        {
          id: 'give-key',
          when: [
            { questComplete: 'collect-components' },
            { flag: 'technicianGaveKey', equals: false },
          ],
          dialogue: 'Tady m√°≈° kl√≠ƒç. Dve≈ôe otev≈ôe≈° smƒõrem na v√Ωchod do nov√© mapy.',
          rewardId: 'technician-gate-key',
          setState: { technicianGaveKey: true },
        },
        {
          id: 'tech-default',
          dialogue: 'Dve≈ôe u≈æ jsou otev≈ôen√©. Vejdi d√°l a pozor na nov√© prostory.',
        },
      ],
    },
  },
  rewards: {
    'caretaker-apple': {
      id: 'caretaker-apple',
      item: { id: 'apple', name: 'Jablko', icon: 'üçé', tint: '#f25c5c' },
      note: 'Spr√°vce ti p≈ôedal jablko. Pou≈æij ƒç√≠slo slotu (1-6) nebo klikni na slot pro doplnƒõn√≠ jednoho ≈æivota.',
      blockedDialogue: 'Invent√°≈ô m√°≈° pln√Ω, uvolni si m√≠sto, a≈• ti m≈Ø≈æu d√°t jablko.',
      blockedNote: 'Nem√°≈° m√≠sto na jablko. Uvolni slot a promluv si se Spr√°vcem znovu.',
    },
    'technician-gate-key': {
      id: 'technician-gate-key',
      item: { id: 'gate-key', name: 'Kl√≠ƒç od dve≈ô√≠', icon: 'üîë', tint: '#f2d45c' },
      note: 'Kl√≠ƒç z√≠sk√°n! V√Ωchodn√≠ dve≈ôe se odemkly a mapa se roz≈°√≠≈ôila.',
      blockedDialogue: 'Tv≈Øj invent√°≈ô je pln√Ω, uvolni si m√≠sto na kl√≠ƒç.',
      actions: {
        unlockGate: true,
        clearObjectives: true,
        setAreaName: 'Nov√© servisn√≠ k≈ô√≠dlo',
        setLevelNumber: 1,
      },
    },
  },
};
